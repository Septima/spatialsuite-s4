<?xml version="1.0" encoding="UTF-8"?>
<tool type="plugin">
    <requires>
    [if: ModuleDefined("s4") ]
        <include src="[module:s4.dir]/tools/s4-requires.xml" nodes="/tool/requires/*" mustexist="true"/>
    [endif]
   </requires>
    <jssrc/>
    <src><![CDATA[
    [if: ModuleDefined("s4") ]
            if (_s4Params.dawasearcher && _s4Params.dawasearcher.enabled && _s4Params.plansearcher && _s4Params.plansearcher.enabled){
                _s4Params.dawasearcher.searcher.addDetailHandlerDef({
                    "buttonText":  'Vedtaget lokalplan', //cbInfo.getString('s4.themesearcher.tools'),
                    "buttonImage": Septima.Search.icons.searchers.planer.result,
                    "handler": Septima.bind(function(result){
                        var promise = new Promise(function(resolve, reject){
                            var onResolve = Septima.bind(function(resolve, planResult){
                                 var items = [];
                                 if (planResult === null){
                                     items.push({type: 'textarea', text: 'Ingen lokalplan fundet for adressen'});
                                 }else{
                                     items.push({type: 'textarea', icon: Septima.Search.icons.searchers.planer.result, text: planResult.title});
                                     items.push({type: 'textarea', text: planResult.description});
                                     items.push({type: 'area', value: 'Mere ...', result: planResult, clickable: true, hoverable: true, isListItem: false});
                                 }
                                 resolve(items);
                             }, this, resolve);
                            var onReject = Septima.bind(function(resolve, error){
                                 var items = [];
                                 items.push({type: 'textarea', text: 'Der opstod en fejl'});
                                 resolve(items);
                             }, this, resolve);
                            _s4Params.plansearcher.searcher.getPlanForPoint(result.geometry).then(onResolve, onReject);
                        });
                        return promise;
                    }, this)
                });
            }
            if (Septima.Log){
                Septima.Log.trace({
                    eventCategory: 's4',
                    eventAction: 's4_details',
                    eventLabel: 'adressePlaner-plugin'
                });
            }
    [endif]
    ]]>
    </src>
</tool>
